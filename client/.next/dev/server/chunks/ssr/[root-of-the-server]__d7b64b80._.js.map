{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krishan%20kant/Desktop/projects/chessss/client/src/lib/api.ts"],"sourcesContent":["const API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:5000\";\r\n\r\ninterface ApiResponse<T> {\r\n    data?: T;\r\n    error?: string;\r\n}\r\n\r\nasync function request<T>(\r\n    endpoint: string,\r\n    options: RequestInit = {}\r\n): Promise<ApiResponse<T>> {\r\n    const token = typeof window !== \"undefined\" ? localStorage.getItem(\"token\") : null;\r\n\r\n    const headers: HeadersInit = {\r\n        \"Content-Type\": \"application/json\",\r\n        ...(token && { Authorization: `Bearer ${token}` }),\r\n        ...options.headers,\r\n    };\r\n\r\n    try {\r\n        const response = await fetch(`${API_URL}${endpoint}`, {\r\n            ...options,\r\n            headers,\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (!response.ok) {\r\n            return { error: data.message || \"An error occurred\" };\r\n        }\r\n\r\n        return { data };\r\n    } catch (error) {\r\n        console.error(\"API Error:\", error);\r\n        return { error: \"Network error. Please try again.\" };\r\n    }\r\n}\r\n\r\n// Auth API\r\nexport const authApi = {\r\n    register: (username: string, email: string, password: string) =>\r\n        request<{ token: string; user: User }>(\"/api/auth/register\", {\r\n            method: \"POST\",\r\n            body: JSON.stringify({ username, email, password }),\r\n        }),\r\n\r\n    login: (email: string, password: string) =>\r\n        request<{ token: string; user: User }>(\"/api/auth/login\", {\r\n            method: \"POST\",\r\n            body: JSON.stringify({ email, password }),\r\n        }),\r\n\r\n    me: () => request<{ user: User }>(\"/api/auth/me\"),\r\n\r\n    logout: () => request(\"/api/auth/logout\", { method: \"POST\" }),\r\n};\r\n\r\n// Rooms API\r\nexport const roomsApi = {\r\n    create: (data: CreateRoomData) =>\r\n        request<{ room: Room }>(\"/api/rooms/create\", {\r\n            method: \"POST\",\r\n            body: JSON.stringify(data),\r\n        }),\r\n\r\n    join: (roomId: string) =>\r\n        request<{ room: Room }>(`/api/rooms/join/${roomId}`, {\r\n            method: \"POST\",\r\n        }),\r\n\r\n    get: (roomId: string) => request<{ room: Room }>(`/api/rooms/${roomId}`),\r\n\r\n    getHistory: (page = 1, limit = 20) =>\r\n        request<{ matches: Match[]; pagination: Pagination }>(\r\n            `/api/rooms/history/matches?page=${page}&limit=${limit}`\r\n        ),\r\n\r\n    getMatch: (matchId: string) =>\r\n        request<{ match: Match }>(`/api/rooms/history/match/${matchId}`),\r\n\r\n    getMatchByRoom: (roomId: string) =>\r\n        request<{ match: Match }>(`/api/rooms/history/room/${roomId}`),\r\n};\r\n\r\n// Types\r\nexport interface User {\r\n    id: string;\r\n    _id?: string;\r\n    username: string;\r\n    email?: string;\r\n    rating: number;\r\n    gamesPlayed: number;\r\n    wins: number;\r\n    losses: number;\r\n    draws: number;\r\n    isOnline?: boolean;\r\n    isGuest?: boolean;\r\n    guestId?: string;\r\n}\r\n\r\nexport interface Room {\r\n    roomId: string;\r\n    player1: Player;\r\n    player2: Player;\r\n    gameStatus: \"waiting\" | \"in_progress\" | \"finished\" | \"abandoned\";\r\n    currentTurn: \"white\" | \"black\";\r\n    timeControl: number;\r\n    matchType: \"casual\" | \"rated\" | \"ai\";\r\n    gameData: GameData;\r\n    result?: GameResult;\r\n    isPrivate: boolean;\r\n    aiLevel?: number;\r\n}\r\n\r\nexport interface Player {\r\n    userId?: string;\r\n    guestId?: string;\r\n    guestUsername?: string;\r\n    color: \"white\" | \"black\";\r\n    timeLeft: number;\r\n}\r\n\r\nexport interface GameData {\r\n    fen: string;\r\n    pgn: string;\r\n    moves: Move[];\r\n}\r\n\r\nexport interface Move {\r\n    from: string;\r\n    to: string;\r\n    piece: string;\r\n    san?: string;\r\n    fen?: string;\r\n    timestamp?: Date;\r\n    timeLeft?: number;\r\n    moveNumber?: number;\r\n}\r\n\r\nexport interface GameResult {\r\n    winner: \"white\" | \"black\" | \"draw\";\r\n    reason: string;\r\n}\r\n\r\nexport interface Match {\r\n    _id: string;\r\n    userId: User;\r\n    opponentId?: User;\r\n    roomId: string;\r\n    result: \"win\" | \"loss\" | \"draw\";\r\n    userColor: \"white\" | \"black\";\r\n    matchType: \"casual\" | \"rated\" | \"ai\";\r\n    timeControl: number;\r\n    ratingBefore: number;\r\n    ratingAfter: number;\r\n    ratingChange: number;\r\n    gameData: {\r\n        pgn: string;\r\n        finalFen: string;\r\n        startingFen?: string;\r\n        moveCount: number;\r\n        gameDuration: number;\r\n        moves?: Move[];\r\n    };\r\n    endReason: string;\r\n    createdAt: string;\r\n}\r\n\r\nexport interface CreateRoomData {\r\n    timeControl: number;\r\n    matchType: \"casual\" | \"rated\" | \"ai\";\r\n    isPrivate?: boolean;\r\n    aiLevel?: number;\r\n    isGuest?: boolean;\r\n    guestUsername?: string;\r\n}\r\n\r\nexport interface Pagination {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    pages: number;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA,MAAM,UAAU,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AAOnD,eAAe,QACX,QAAgB,EAChB,UAAuB,CAAC,CAAC;IAEzB,MAAM,QAAQ,sCAAgC,0BAAgC;IAE9E,MAAM,UAAuB;QACzB,gBAAgB;QAChB,GAAI,SAAS;YAAE,eAAe,CAAC,OAAO,EAAE,OAAO;QAAC,CAAC;QACjD,GAAG,QAAQ,OAAO;IACtB;IAEA,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,GAAG,UAAU,UAAU,EAAE;YAClD,GAAG,OAAO;YACV;QACJ;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,OAAO;gBAAE,OAAO,KAAK,OAAO,IAAI;YAAoB;QACxD;QAEA,OAAO;YAAE;QAAK;IAClB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO;YAAE,OAAO;QAAmC;IACvD;AACJ;AAGO,MAAM,UAAU;IACnB,UAAU,CAAC,UAAkB,OAAe,WACxC,QAAuC,sBAAsB;YACzD,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAU;gBAAO;YAAS;QACrD;IAEJ,OAAO,CAAC,OAAe,WACnB,QAAuC,mBAAmB;YACtD,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAO;YAAS;QAC3C;IAEJ,IAAI,IAAM,QAAwB;IAElC,QAAQ,IAAM,QAAQ,oBAAoB;YAAE,QAAQ;QAAO;AAC/D;AAGO,MAAM,WAAW;IACpB,QAAQ,CAAC,OACL,QAAwB,qBAAqB;YACzC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;QACzB;IAEJ,MAAM,CAAC,SACH,QAAwB,CAAC,gBAAgB,EAAE,QAAQ,EAAE;YACjD,QAAQ;QACZ;IAEJ,KAAK,CAAC,SAAmB,QAAwB,CAAC,WAAW,EAAE,QAAQ;IAEvE,YAAY,CAAC,OAAO,CAAC,EAAE,QAAQ,EAAE,GAC7B,QACI,CAAC,gCAAgC,EAAE,KAAK,OAAO,EAAE,OAAO;IAGhE,UAAU,CAAC,UACP,QAA0B,CAAC,yBAAyB,EAAE,SAAS;IAEnE,gBAAgB,CAAC,SACb,QAA0B,CAAC,wBAAwB,EAAE,QAAQ;AACrE"}},
    {"offset": {"line": 175, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krishan%20kant/Desktop/projects/chessss/client/src/lib/socket.ts"],"sourcesContent":["import { io, Socket } from \"socket.io-client\";\r\n\r\nclass SocketService {\r\n    private socket: Socket | null = null;\r\n    private reconnectAttempts = 0;\r\n    private maxReconnectAttempts = 10;\r\n    private visibilityChangeHandler: (() => void) | null = null;\r\n\r\n    getSocket(): Socket | null {\r\n        return this.socket;\r\n    }\r\n\r\n    connect(token?: string, guestId?: string, guestUsername?: string): Socket | null {\r\n        if (this.socket?.connected) {\r\n            console.log(\"Socket already connected\");\r\n            return this.socket;\r\n        }\r\n\r\n        const url = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:5000\";\r\n\r\n        this.socket = io(url, {\r\n            auth: guestId ? { guestId, guestUsername } : { token },\r\n            transports: [\"websocket\", \"polling\"],\r\n            reconnection: true,\r\n            reconnectionAttempts: this.maxReconnectAttempts,\r\n            reconnectionDelay: 1000,\r\n            reconnectionDelayMax: 5000,\r\n            timeout: 20000,\r\n        });\r\n\r\n        this.setupEventListeners();\r\n        this.setupMobileHandlers();\r\n\r\n        return this.socket;\r\n    }\r\n\r\n    private setupEventListeners() {\r\n        if (!this.socket) return;\r\n\r\n        this.socket.on(\"connect\", () => {\r\n            console.log(\"✅ Socket connected:\", this.socket?.id);\r\n            this.reconnectAttempts = 0;\r\n        });\r\n\r\n        this.socket.on(\"disconnect\", (reason) => {\r\n            console.log(\"❌ Socket disconnected:\", reason);\r\n\r\n            // Auto-reconnect on mobile when app comes back to foreground\r\n            if (reason === \"transport close\" || reason === \"ping timeout\") {\r\n                console.log(\"Attempting to reconnect...\");\r\n            }\r\n        });\r\n\r\n        this.socket.on(\"connect_error\", (error) => {\r\n            console.error(\"Socket connection error:\", error);\r\n            this.reconnectAttempts++;\r\n\r\n            if (this.reconnectAttempts >= this.maxReconnectAttempts) {\r\n                console.error(\"Max reconnection attempts reached\");\r\n            }\r\n        });\r\n\r\n        this.socket.on(\"reconnect\", (attemptNumber) => {\r\n            console.log(\"✅ Socket reconnected after\", attemptNumber, \"attempts\");\r\n        });\r\n\r\n        this.socket.on(\"error\", (error) => {\r\n            console.error(\"Socket error:\", error);\r\n        });\r\n    }\r\n\r\n    private setupMobileHandlers() {\r\n        // Handle app going to background/foreground on mobile\r\n        if (typeof document !== \"undefined\") {\r\n            this.visibilityChangeHandler = () => {\r\n                if (document.visibilityState === \"visible\") {\r\n                    // App came to foreground\r\n                    console.log(\"App visible - checking socket connection\");\r\n                    if (!this.socket?.connected) {\r\n                        console.log(\"Socket disconnected while in background - reconnecting\");\r\n                        this.socket?.connect();\r\n                    }\r\n                } else {\r\n                    // App went to background\r\n                    console.log(\"App hidden - socket may disconnect\");\r\n                }\r\n            };\r\n\r\n            document.addEventListener(\"visibilitychange\", this.visibilityChangeHandler);\r\n        }\r\n\r\n        // Handle page visibility for iOS Safari\r\n        if (typeof window !== \"undefined\") {\r\n            window.addEventListener(\"focus\", () => {\r\n                if (!this.socket?.connected) {\r\n                    console.log(\"Window focused - reconnecting socket\");\r\n                    this.socket?.connect();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    disconnect() {\r\n        if (this.visibilityChangeHandler) {\r\n            document.removeEventListener(\"visibilitychange\", this.visibilityChangeHandler);\r\n        }\r\n\r\n        if (this.socket) {\r\n            this.socket.disconnect();\r\n            this.socket = null;\r\n        }\r\n    }\r\n\r\n    // Authentication\r\n    authenticate(token: string) {\r\n        this.socket?.emit(\"authenticate\", token);\r\n    }\r\n\r\n    authenticateGuest(username: string, guestId?: string) {\r\n        this.socket?.emit(\"authenticate_guest\", { username, guestId });\r\n    }\r\n\r\n    // Room operations\r\n    createRoom(data: {\r\n        timeControl: number;\r\n        matchType: \"casual\" | \"rated\" | \"ai\";\r\n        isPrivate?: boolean;\r\n        aiLevel?: number;\r\n        preferredColor?: string;\r\n    }) {\r\n        this.socket?.emit(\"create_room\", data);\r\n    }\r\n\r\n    joinRoom(roomId: string) {\r\n        this.socket?.emit(\"join_room\", { roomId });\r\n    }\r\n\r\n    joinRoomAsPlayer(roomId: string) {\r\n        this.socket?.emit(\"join_room_as_player\", { roomId });\r\n    }\r\n\r\n    joinQueue(data: {\r\n        matchType: \"casual\" | \"rated\";\r\n        timeControl: number;\r\n        preferredColor: string;\r\n    }) {\r\n        this.socket?.emit(\"join_queue\", data);\r\n    }\r\n\r\n    leaveQueue() {\r\n        this.socket?.emit(\"leave_queue\");\r\n    }\r\n\r\n    // Game actions\r\n    makeMove(roomId: string, move: { from: string; to: string; promotion?: string }) {\r\n        this.socket?.emit(\"make_move\", { roomId, move });\r\n    }\r\n\r\n    resign(roomId: string) {\r\n        this.socket?.emit(\"resign\", { roomId });\r\n    }\r\n\r\n    offerDraw(roomId: string) {\r\n        this.socket?.emit(\"offer_draw\", { roomId });\r\n    }\r\n\r\n    respondToDraw(roomId: string, accept: boolean) {\r\n        this.socket?.emit(\"draw_response\", { roomId, accept });\r\n    }\r\n\r\n    sendMessage(roomId: string, message: string) {\r\n        this.socket?.emit(\"send_message\", { roomId, message });\r\n    }\r\n\r\n    // Event listeners\r\n    onAuthenticated(callback: (data: any) => void) {\r\n        this.socket?.on(\"authenticated\", callback);\r\n        return () => this.socket?.off(\"authenticated\", callback);\r\n    }\r\n\r\n    onAuthError(callback: (data: any) => void) {\r\n        this.socket?.on(\"authentication_error\", callback);\r\n        return () => this.socket?.off(\"authentication_error\", callback);\r\n    }\r\n\r\n    onRoomCreated(callback: (data: any) => void) {\r\n        this.socket?.on(\"room_created\", callback);\r\n        return () => this.socket?.off(\"room_created\", callback);\r\n    }\r\n\r\n    onRoomUpdate(callback: (data: any) => void) {\r\n        this.socket?.on(\"room_update\", callback);\r\n        return () => this.socket?.off(\"room_update\", callback);\r\n    }\r\n\r\n    onGameStarted(callback: (data: any) => void) {\r\n        this.socket?.on(\"game_started\", callback);\r\n        return () => this.socket?.off(\"game_started\", callback);\r\n    }\r\n\r\n    onMatchFound(callback: (data: any) => void) {\r\n        this.socket?.on(\"match_found\", callback);\r\n        return () => this.socket?.off(\"match_found\", callback);\r\n    }\r\n\r\n    onMoveMade(callback: (data: any) => void) {\r\n        this.socket?.on(\"move_made\", callback);\r\n        return () => this.socket?.off(\"move_made\", callback);\r\n    }\r\n\r\n    onTimeUpdate(callback: (data: any) => void) {\r\n        this.socket?.on(\"time_update\", callback);\r\n        return () => this.socket?.off(\"time_update\", callback);\r\n    }\r\n\r\n    onGameEnded(callback: (data: any) => void) {\r\n        this.socket?.on(\"game_ended\", callback);\r\n        return () => this.socket?.off(\"game_ended\", callback);\r\n    }\r\n\r\n    onChatMessage(callback: (data: any) => void) {\r\n        this.socket?.on(\"chat_message\", callback);\r\n        return () => this.socket?.off(\"chat_message\", callback);\r\n    }\r\n\r\n    onDrawOffered(callback: (data: any) => void) {\r\n        this.socket?.on(\"draw_offered\", callback);\r\n        return () => this.socket?.off(\"draw_offered\", callback);\r\n    }\r\n\r\n    onDrawDeclined(callback: () => void) {\r\n        this.socket?.on(\"draw_declined\", callback);\r\n        return () => this.socket?.off(\"draw_declined\", callback);\r\n    }\r\n\r\n    onOpponentDisconnected(callback: () => void) {\r\n        this.socket?.on(\"opponent_disconnected\", callback);\r\n        return () => this.socket?.off(\"opponent_disconnected\", callback);\r\n    }\r\n\r\n    onOpponentReconnected(callback: () => void) {\r\n        this.socket?.on(\"opponent_reconnected\", callback);\r\n        return () => this.socket?.off(\"opponent_reconnected\", callback);\r\n    }\r\n\r\n    onGameReconnected(callback: (data: any) => void) {\r\n        this.socket?.on(\"reconnected_to_game\", callback);\r\n        return () => this.socket?.off(\"reconnected_to_game\", callback);\r\n    }\r\n\r\n    onQueueJoined(callback: (data: any) => void) {\r\n        this.socket?.on(\"queue_joined\", callback);\r\n        return () => this.socket?.off(\"queue_joined\", callback);\r\n    }\r\n\r\n    onError(callback: (data: any) => void) {\r\n        this.socket?.on(\"error\", callback);\r\n        return () => this.socket?.off(\"error\", callback);\r\n    }\r\n}\r\n\r\nconst socketService = new SocketService();\r\nexport default socketService;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 409, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/krishan%20kant/Desktop/projects/chessss/client/src/context/AuthContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { createContext, useContext, useEffect, useState, useCallback } from \"react\";\r\nimport { authApi, User } from \"@/lib/api\";\r\nimport socketService from \"@/lib/socket\";\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    isLoading: boolean;\r\n    isAuthenticated: boolean;\r\n    isGuest: boolean;\r\n    login: (email: string, password: string) => Promise<{ success: boolean; error?: string }>;\r\n    register: (username: string, email: string, password: string) => Promise<{ success: boolean; error?: string }>;\r\n    loginAsGuest: (username: string) => void;\r\n    logout: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    // Initialize auth on mount\r\n    useEffect(() => {\r\n        const initAuth = async () => {\r\n            const token = localStorage.getItem(\"token\");\r\n            const guestId = localStorage.getItem(\"guestId\");\r\n            const guestUsername = localStorage.getItem(\"guestUsername\");\r\n\r\n            // Connect socket\r\n            const socket = socketService.connect();\r\n\r\n            if (token) {\r\n                // Try to authenticate with token\r\n                const { data, error } = await authApi.me();\r\n                if (data?.user) {\r\n                    setUser(data.user);\r\n                    socketService.authenticate(token);\r\n                } else {\r\n                    // Token invalid, clear it\r\n                    localStorage.removeItem(\"token\");\r\n                }\r\n            } else if (guestId && guestUsername) {\r\n                // Reconnect as guest\r\n                setUser({\r\n                    id: guestId,\r\n                    username: guestUsername,\r\n                    rating: 600,\r\n                    gamesPlayed: 0,\r\n                    wins: 0,\r\n                    losses: 0,\r\n                    draws: 0,\r\n                    isGuest: true,\r\n                    guestId,\r\n                });\r\n                socketService.authenticateGuest(guestUsername, guestId);\r\n            }\r\n\r\n            setIsLoading(false);\r\n\r\n            // Listen for auth events\r\n            socketService.onAuthenticated((data) => {\r\n                if (data.user.isGuest) {\r\n                    localStorage.setItem(\"guestId\", data.user.guestId || data.user.id);\r\n                    localStorage.setItem(\"guestUsername\", data.user.username);\r\n                }\r\n                setUser(data.user);\r\n            });\r\n\r\n            socketService.onAuthError((data) => {\r\n                console.error(\"Auth error:\", data.message);\r\n            });\r\n        };\r\n\r\n        initAuth();\r\n\r\n        return () => {\r\n            socketService.disconnect();\r\n        };\r\n    }, []);\r\n\r\n    const login = useCallback(async (email: string, password: string) => {\r\n        const { data, error } = await authApi.login(email, password);\r\n\r\n        if (data?.token && data?.user) {\r\n            localStorage.setItem(\"token\", data.token);\r\n            localStorage.removeItem(\"guestId\");\r\n            localStorage.removeItem(\"guestUsername\");\r\n            setUser(data.user);\r\n            socketService.authenticate(data.token);\r\n            return { success: true };\r\n        }\r\n\r\n        return { success: false, error: error || \"Login failed\" };\r\n    }, []);\r\n\r\n    const register = useCallback(async (username: string, email: string, password: string) => {\r\n        const { data, error } = await authApi.register(username, email, password);\r\n\r\n        if (data?.token && data?.user) {\r\n            localStorage.setItem(\"token\", data.token);\r\n            localStorage.removeItem(\"guestId\");\r\n            localStorage.removeItem(\"guestUsername\");\r\n            setUser(data.user);\r\n            socketService.authenticate(data.token);\r\n            return { success: true };\r\n        }\r\n\r\n        return { success: false, error: error || \"Registration failed\" };\r\n    }, []);\r\n\r\n    const loginAsGuest = useCallback((username: string) => {\r\n        const existingGuestId = localStorage.getItem(\"guestId\");\r\n        socketService.authenticateGuest(username, existingGuestId || undefined);\r\n\r\n        // User will be set when we receive the authenticated event\r\n    }, []);\r\n\r\n    const logout = useCallback(() => {\r\n        localStorage.removeItem(\"token\");\r\n        localStorage.removeItem(\"guestId\");\r\n        localStorage.removeItem(\"guestUsername\");\r\n        setUser(null);\r\n        socketService.disconnect();\r\n        window.location.href = \"/\";\r\n    }, []);\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                user,\r\n                isLoading,\r\n                isAuthenticated: !!user,\r\n                isGuest: user?.isGuest || false,\r\n                login,\r\n                register,\r\n                loginAsGuest,\r\n                logout,\r\n            }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useAuth() {\r\n    const context = useContext(AuthContext);\r\n    if (context === undefined) {\r\n        throw new Error(\"useAuth must be used within an AuthProvider\");\r\n    }\r\n    return context;\r\n}\r\n"],"names":[],"mappings":"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"}}]
}